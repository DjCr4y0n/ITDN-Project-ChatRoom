<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Chat Room</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"
            integrity="sha384-..."
            crossorigin="anonymous"></script>
  </head>
  <body>
    <h2>Chat Room â€“ logged in as {{ username }}</h2>
    <div id="chatbox" style="border:1px solid #ccc;height:300px;overflow:auto;"></div>
    <input id="msgInput" autocomplete="off" placeholder="Type your message..."/>
    <button id="sendBtn">Send</button>

    <script>
      const socket = io();  // connects back to same host/port

      const messagesDiv = document.getElementById("chatbox");
      const input = document.getElementById("msgInput");
      const sendBtn = document.getElementById("sendBtn");

      function addMessage(text) {
        const p = document.createElement("p");
        p.innerText = text;
        messagesDiv.appendChild(p);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
      }

      socket.on("chat_message", (data) => {
        addMessage(`${data.username}: ${data.message}`);
      });

      sendBtn.onclick = function() {
        const text = input.value.trim();
        if (!text) return;
        socket.emit("chat_message", {message: text});
        input.value = "";
      };

      input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") sendBtn.click();
      });
    </script>
  </body>
</html>
